<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="./plugin/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="./plugin/datepicker/datepicker3.min.css" />

    <!-- 20210903: zPivottable -->
    <link rel="stylesheet" href="./plugin/zPivottable/pivot.css" />
    <!-- <link rel="stylesheet" href="./plugin/zPivottable/pivot.min.css" /> -->

    <script src="./plugin/jQuery/jQuery-2.1.4.min.js"></script>
    <script src="./plugin/jQueryUI/jquery-ui.min.js"></script>
    <script src="./plugin/bootstrap/js/bootstrap.min.js"></script>
    <script src="./plugin/datepicker/bootstrap-datepicker.min.js"></script>
    <script src="./plugin/slimScroll-1.3.8/jquery.slimscroll.min.js"></script>

    <script src="./plugin/table-to-excel/tableToExcel.js"></script>

    <!-- 20210903: zPivottable -->
    <!-- <script src="./plugin/zPivottable/pivot.js"></script> -->
    <script src="./plugin/zPivottable/pivot.min.js"></script>

    <script src="./test_data.js"></script>
</head>

<body class="main">
    <div>
        <!-- 필터 영역 Start -->
        <div class="search"
            style="margin-top:40px; margin-bottom: 40px; padding-bottom:20px; border-bottom: 1px solid #ccc;">
            <div>
                <div style="text-align: center; margin-bottom: 20px;">
                    <h3>국립중앙박물관 통계 시스템 </h3>
                </div>
            </div>
            <div class="row text-center">
                <form class="form-inline">
                    <div class="form-group">
                        <label>기간조회</label>
                        <span style="margin-left: 10px; margin-right: 10px;">|</span>
                        <input type="text" class="form-control" id="startDt" placeholder="2021-08-13">
                        <span style="margin-left: 10px; margin-right: 10px;">~</span>
                        <input type="text" class="form-control" id="endDt" placeholder="2021-09-13">
                    </div>
                    <button type="submit" class="btn btn-default" style="margin-left: 20px;">조회</button>
                </form>
            </div>
        </div>
        <!-- 필터 영역 End -->

        <!-- Pivot Table 영역 Start -->
        <div class="minwon">
            <div style="text-align: right; width: 95%; margin-bottom: 15px;">
                <input type="button" class="btn btn-primary" id="btnExcelDownload" value="엑셀 다운로드" />
            </div>
            <!-- <div id="test" style="height: 800px; overflow: auto; width: 100%;"></div> -->
            <div id="test" style="margin-bottom: 50px;"></div>
        </div>
        <!-- Pivot Table 영역 End -->

        <a type="hidden" id="downloadLink"></a>

    </div>
</body>
<script>

    // Datapicker setting start
    var datapickerFormat = "yyyy-mm-dd";
    $("#startDt").datepicker({
        format: datapickerFormat,
        startDate: '-1m'
    });
    $("#endDt").datepicker({
        format: datapickerFormat,
    });
    // Datapicker setting End

    // Create Pivot Table Start
    $.getJSON("./data/sample.json", function (data) {
        console.log(data);

        $("#test").pivotUI(
            data.data,
            {
                rows: ["ACCESSION_DATE"],
                cols: ["JOB", "SEX", "USER_TYPE", "AGE"],
                vals: ["CNT"],
                aggregatorName: "Integer Sum",
                rendererName: "Heatmap",
                onRefresh: function () {
                    // 차트 생성될 때 호출되는 익명함수
                    console.log("ee?");
                    // $(".pvtTableWrapper").slimScroll({ height: "500px;" });

                    // TODO 1 : 가로스크롤 기능이 있는 라이브러리로 변경
                    // TODO 2 : 고정된 Header 외곽선 출력되도록 수정
                }
            }
        );
    });
    // Create Pivot Table End

    // Excel Download Start
    $("#btnExcelDownload").click(function (e) {
        tableToExcel();
    });

    // Excel 다운로드 : 이런 식으로 저장된다는 걸 보여주기 위한 용도
    function tableToExcel() {
        document.getElementsByClassName("pvtTable")[0].setAttribute("id", "pvtTable");

        TableToExcel.convert(document.getElementById("pvtTable"), {
            name: "table1.xlsx",
            sheet: {
                name: "Sheet 1"
            }
        });
    }
    // Excel Download End

</script>

</html>