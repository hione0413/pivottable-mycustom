var _tableData={},_tableOriginData={},_tableChangedData={};function checkTableEditedYn(a,e,n){for(var t=0;t<a.length;t++)if(a[t][e]===n)return!1;return!0}function handleClickSubmitTableCancleBtn(a){console.log("[handleClickSubmitTableCancleBtn] tableKey",a),console.log("click cancle btn")}function handleClickSubmitTableSubmitBtn(a){console.log("[handleClickSubmitTableSubmitBtn] tableKey",a),console.log("click submit btn",_tableChangedData),0===Object.keys(_tableChangedData).length&&alert("변경된 내용이 없습니다.")}function realignDataByDoubleDimension(a,e,n,t){for(var l=[],r={},i=0;i<a.length;i++){var o=a[i];r[e]&&r[e]!==o[e]&&(l.push(r),r={}),r[e]||(r[e]=o[e]),r[o[n]]||(r[o[n]]={});for(var c=0;c<t.length;c++)r[o[n]][t[c]]=o[t[c]];i===a.length-1&&l.push(r)}return l}function compareChangedTableValue(a){for(var e=_TABLE_PARAM[a],n=e.tbodyInfo,t=e.theadInfo,l=_tableData[a],r=_tableOriginData[a],i=[],o=0;o<l.length;o++){for(var c=l[o],s=r[o],d="",u="",h=0;h<t.length;h++){var g=t[h].dimension;d=g,u=c[g]}for(h=0;h<n.length;h++){n[h].name;var b=n[h].dimension,f=n[h].measure,m=n[h].insertFlag,p="",v="";n[h].calcFunc?(p=n[h].calcFunc(c),v=n[h].calcFunc(s)):b&&f&&(p=c[b][f],v=s[b][f]);if(m){var _=$("#"+(a+"_"+u+"_"+b+"_"+f));if(p!==v){_.css("color","red");var T={dimensionFirst:d,dimensionFirstValue:u,dimensionSecond:b,measure:f,changedMeasureValue:p};i.push(T)}else _.css("color","black")}else{var D=$("#"+(a+"_"+o+"_"+h));D.html(p),p!==v?D.css("color","red"):D.css("color","black")}}}_tableChangedData[a]=i}function handleChangeTableCellValue(a,e,n,t,l,r){var i=a.target;i.value,$("#"+(e+"_"+t+"_"+l+"_"+r));if(a.which&&(a.which>47&&a.which<58||8===a.which)){for(var o=_tableData[e],c=0;c<o.length;c++)if(o[c][n]==t){o[c][l][r]=parseInt(i.value);break}compareChangedTableValue(e)}}function createTableTopDimension(a,e){for(var n=e.tableKey,t=JSON.parse(JSON.stringify(e.theadHtmlArr)),l=e.theadInfo,r=JSON.parse(JSON.stringify(e.tbodyHtmlArr)),i=e.tbodyInfo,o=0;o<a.length;o++){for(var c=a[o],s="",d="",u="",h="",g=0;g<l.length;g++){var b=l[g].dimension,f=c[b],m="<th>"+f+"</th>";t[g].push(m),s=b,d=f}for(g=0;g<i.length;g++){i[g].name;var p=i[g].dimension,v=i[g].measure,_=i[g].insertFlag,T="",D="";i[g].calcFunc?T=i[g].calcFunc(c):p&&v&&(u=p,h=v,T=c[p][v]);var C=n+"_"+o+"_"+g;if(_)D='<td id="'+C+'">'+('<input type="number" class="form-control" value="'+T+'"  id="'+n+"_"+d+"_"+u+"_"+h+'"  onKeyup="handleChangeTableCellValue(event, \''+n+"', '"+s+"', '"+d+"', '"+u+"', '"+h+"')\"/>")+"</td>";else D='<td id="'+C+'">'+T+"</td>";r[g].push(D)}}t.push("</tr>"),r.push("</tr>"),$("#"+e.theadId).empty(),$("#"+e.tbodyId).empty(),$("#"+e.theadId).html(t.join()),$("#"+e.tbodyId).html(r.join())}function initTableTopDimension(a,e,n,t,l){var r=checkTableEditedYn(a,"입력YN","N"),i=l.tableKey,o=l.btnCancleId,c=l.btnSubmitId,s=$("#"+c);typeof r===Boolean&&r?s.attr("disabled",!1):s.attr("disabled",!0),$("#"+o).click(function(){handleClickSubmitTableCancleBtn(i)}),s.click(function(){handleClickSubmitTableSubmitBtn(i)});var d=realignDataByDoubleDimension(a,e,n,t);_tableData[l.tableKey]=d,_tableOriginData[l.tableKey]=JSON.parse(JSON.stringify(d)),createTableTopDimension(d,l)}function compareChangedTableValueTp2(a){for(var e=_TABLE_PARAM[a],n=e.tableColumnInfo,t=e.totalRowFlag,l=_tableData[a],r=_tableOriginData[a],i=[],o=[],c=[],s=0;s<l.length;s++){var d=l[s];console.log("targetDataObj",d);for(var u=r[s],h=e.dimensionFirstKey,g=d[h],b=1;b<n.length;b++){n[b].name;var f=n[b].dimension,m=n[b].measure,p=n[b].insertFlag,v="",_="";n[b].calcFunc?(v=n[b].calcFunc(d),_=n[b].calcFunc(u)):f&&m&&(v=d[f][m],_=u[f][m]);var T=a+"_"+s+"_"+b;if(p){var D=$("#"+T).children("input");if(v!==_){D.css("color","red");var C={dimensionFirst:h,dimensionFirstValue:g,dimensionSecond:f,measure:m,changedMeasureValue:v};c.push(C)}else D.css("color","black")}else{T=a+"_"+s+"_"+b;(k=$("#"+T)).html(v),v!==_?k.css("color","red"):k.css("color","black")}if(t){var y=i[b]?i[b]+v:v,F=o[b]?o[b]+_:_;i[b]=y,o[b]=F}}}if(t)for(s=0;s<i.length;s++){var k;T=a+"_total_"+s;(k=$("#"+T)).html(i[s]),i[s]!==o[s]?k.css("color","red"):k.css("color","black")}_tableChangedData[a]=c}function handleChangeTableCellValueTp2(a,e,n,t,l,r){var i=a.target;i.value,$("#"+(e+"_"+t+"_"+l+"_"+r));if(a.which&&(a.which>47&&a.which<58||8===a.which)){for(var o=_tableData[e],c=0;c<o.length;c++)if(o[c][n]==t){o[c][l][r]=parseInt(i.value);break}compareChangedTableValueTp2(e)}}function createTableLeftDimension(a,e){for(var n=e.tableKey,t=(e.tableId,e.tbodyId),l=e.dimensionFirstKey,r=e.tableColumnInfo,i=e.nonInsertRow,o=e.totalRowFlag,c=[],s=[],d=0;d<a.length;d++)c[d]=[];for(d=0;d<a.length;d++)for(var u=a[d],h=l,g=u[l],b="",f="",m=0;m<r.length;m++){var p=r[m],v=(p.name,p.dimension),_=p.measure,T=p.insertFlag,D="",C="";p.calcFunc?D=p.calcFunc(u):v&&_?(b=v,f=_,D=u[v][_]):v&&(b=v,D=u[v]);var y=n+"_"+d+"_"+m;if(T&&-1===i.indexOf(d))C='<td id="'+y+'">'+('<input type="number" class="form-control" value="'+D+'"  id="'+n+"_"+g+"_"+b+"_"+f+'"  onKeyup="handleChangeTableCellValueTp2(event, \''+n+"', '"+h+"', '"+g+"', '"+b+"', '"+f+"')\"/>")+"</td>";else C=0==m?'<th id="'+y+'">'+D+"</th>":'<td id="'+y+'">'+D+"</td>";if(o){var F=s[m]?s[m]+D:D;s[m]=F}c[d].push(C)}var k="";for(d=0;d<c.length;d++)k+="<tr>"+c[d].join("")+"</tr>";if(o){k+="<tr><th>계</th>";for(d=1;d<s.length;d++){k+='<td id="'+(n+"_total_"+d)+'">'+s[d]+"</td>"}k+="</tr>"}$("#"+t).empty(),$("#"+t).html(k)}function initTableLeftDimension(a,e,n,t,l){checkTableEditedYn(a,"입력YN","N");var r=realignDataByDoubleDimension(a,e,n,t);_tableData[l.tableKey]=r,_tableOriginData[l.tableKey]=JSON.parse(JSON.stringify(r)),createTableLeftDimension(r,l)}function createDataTableDefault(a,e,n,t,l){for(var r=l.rowNumFlag,i=!!l.pagingFlag&&l.pagingFlag,o=!!l.pagingTurningPoint&&l.pagingTurningPoint,c=["<thead><tr>"],s=[],d=0;d<n.length;d++){var u=n[d].tHeaderName,h=n[d].dataColumnName;c.push("<th>"+u+"</th>"),s.push({data:h,defaultContent:"null"})}c.push("</tr></thead>");var g={data:e,scrollY:"350px",scrollCollapse:!0,paging:i,columns:s,columnDefs:t};o&&e.length>o&&(g.paging=!0);var b=$("#"+a);b.empty(),b.append(c.join(""));var f=b.DataTable(g);r&&f.on("order.dt search.dt",function(){f.column(0,{search:"applied",order:"applied"}).nodes().each(function(a,e){a.innerHTML=e+1})}).draw()}function createDataTableDefault(a,e,n,t,l){for(var r=l.rowNumFlag,i=!!l.pagingFlag&&l.pagingFlag,o=!!l.pagingTurningPoint&&l.pagingTurningPoint,c=["<thead><tr>"],s=[],d=0;d<n.length;d++){var u=n[d].tHeaderName,h=n[d].dataColumnName;c.push("<th>"+u+"</th>"),s.push({data:h,defaultContent:0})}c.push("</tr></thead>");var g={data:e,scrollY:"350px",scrollCollapse:!0,paging:i,columns:s,columnDefs:t};o&&e.length>o&&(g.paging=!0);var b=$("#"+a);b.empty(),b.append(c.join(""));var f=b.DataTable(g);r&&f.on("order.dt search.dt",function(){f.column(0,{search:"applied",order:"applied"}).nodes().each(function(a,e){a.innerHTML=e+1})}).draw()}function getCodeList(a){switch(a){case 1:break;default:return["국내서","서양서","일본서","중국서","기타"]}}function realignDataToPivot(a,e,n,t){for(var l=[],r={},i=0;i<a.length;i++){var o=a[i];r[e]&&r[e]!==o[e]&&(l.push(r),r={}),r[e]||(r[e]=o[e]),r[o[n]]||(r[o[n]]=o[t]),i===a.length-1&&l.push(r)}return l}